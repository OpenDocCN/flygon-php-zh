["```php\n$ cd /Webroot/trackstar/protected\n$ ./yiic migrate create create_user_comments_table\n```", "```php\n  public function up()\n  {\n    //create the issue table\n    $this->createTable('tbl_comment', array(\n      'id' => 'pk',\n          'content' => 'text NOT NULL',\n          'issue_id' => 'int(11) NOT NULL',\n      'create_time' => 'datetime DEFAULT NULL',\n      'create_user_id' => 'int(11) DEFAULT NULL',\n      'update_time' => 'datetime DEFAULT NULL',\n      'update_user_id' => 'int(11) DEFAULT NULL',\n     ), 'ENGINE=InnoDB');\n\n    //the tbl_comment.issue_id is a reference to tbl_issue.id \n    $this->addForeignKey(\"fk_comment_issue\", \"tbl_comment\", \"issue_id\", \"tbl_issue\", \"id\", \"CASCADE\", \"RESTRICT\");\n\n    //the tbl_issue.create_user_id is a reference to tbl_user.id \n    $this->addForeignKey(\"fk_comment_owner\", \"tbl_comment\", \"create_user_id\", \"tbl_user\", \"id\", \"RESTRICT, \"RESTRICT\");\n\n    //the tbl_issue.updated_user_id is a reference to tbl_user.id \n    $this->addForeignKey(\"fk_comment_update_user\", \"tbl_comment\", \"update_user_id\", \"tbl_user\", \"id\", \"RESTRICT\", \"RESTRICT\");\n\n  }\n\n  public function down()\n  {\n    $this->dropForeignKey('fk_comment_issue', 'tbl_comment');\n    $this->dropForeignKey('fk_comment_owner', 'tbl_comment');\n    $this->dropForeignKey('fk_comment_update_user', 'tbl_comment');\n    $this->dropTable('tbl_comment');\n  }\n```", "```php\n$ ./yiic migrate\n```", "```php\n/**\n   * @return array relational rules.\n   */\n  public function relations()\n  {\n    // NOTE: you may need to adjust the relation name and the related\n    // class name for the relations automatically generated below.\n    return array(\n      'updateUser' => array(self::BELONGS_TO, 'User', 'update_user_id'),\n      'issue' => array(self::BELONGS_TO, 'Issue', 'issue_id'),\n      'createUser' => array(self::BELONGS_TO, 'User', 'create_user_id'),\n    );\n  }\n```", "```php\npublic function relations()\n{\n  return array(\n    'requester' => array(self::BELONGS_TO, 'User', 'requester_id'),\n    'owner' => array(self::BELONGS_TO, 'User', 'owner_id'),\n    'project' => array(self::BELONGS_TO, 'Project', 'project_id'),\n    'comments' => array(self::HAS_MANY, 'Comment', 'issue_id'),\n    'commentCount' => array(self::STAT, 'Comment', 'issue_id'),\n  );\n}\n```", "```php\n<?php\n      /**\n * This is the model class for table \"tbl_comment\".\n */\nclass Comment extends TrackStarActiveRecord\n{\n```", "```php\n/**\n  * Adds a comment to this issue\n  */\npublic function addComment($comment)\n{\n  $comment->issue_id=$this->id;\n  return $comment->save();\n}\n```", "```php\npublic function actionView($id)\n{\n    $issue=$this->loadModel($id);\n    $comment=$this->createComment($issue);\n    $this->render('view',array(\n      'model'=>$issue,\n         'comment'=>$comment,\n    ));\n}\n```", "```php\n/**\n  * Creates a new comment on an issue\n  */\nprotected function createComment($issue)\n{\n  $comment=new Comment;  \n  if(isset($_POST['Comment']))\n  {\n    $comment->attributes=$_POST['Comment'];\n    if($issue->addComment($comment))\n    {\n      Yii::app()->user->setFlash('commentSubmitted',\"Your comment has been added.\" );\n      $this->refresh();\n    }\n  }\n  return $comment;\n}\n```", "```php\n<?php foreach($comments as $comment): ?>\n<div class=\"comment\">\n      <div class=\"author\">\n    <?php echo CHtml::encode($comment->author->username); ?>:\n  </div>\n\n  <div class=\"time\">\n    on <?php echo date('F j, Y \\a\\t h:i a',strtotime($comment->create_time)); ?>\n  </div>\n\n  <div class=\"content\">\n    <?php echo nl2br(CHtml::encode($comment->content)); ?>\n  </div>\n     <hr>\n</div><!-- comment -->\n<?php endforeach; ?>\n```", "```php\n<div id=\"comments\">\n  <?php if($model->commentCount>=1): ?>\n    <h3>\n      <?php echo $model->commentCount>1 ? $model->commentCount . ' comments' : 'One comment'; ?>\n    </h3>\n\n    <?php $this->renderPartial('_comments',array(\n      'comments'=>$model->comments,\n    )); ?>\n  <?php endif; ?>\n\n  <h3>Leave a Comment</h3>\n\n  <?php if(Yii::app()->user->hasFlash('commentSubmitted')): ?>\n    <div class=\"flash-success\">\n      <?php echo Yii::app()->user->getFlash('commentSubmitted'); ?>\n    </div>\n  <?php else: ?>\n    <?php $this->renderPartial('/comment/_form',array(\n      'model'=>$comment,\n    )); ?>\n  <?php endif; ?>\n\n</div>\n```", "```php\n<div class=\"form\">\n<?php $form=$this->beginWidget('CActiveForm', array(\n  'id'=>'comment-form',\n  'enableAjaxValidation'=>false,\n)); ?>\n       <p class=\"note\">Fields with <span class=\"required\">*</span> are required.</p>\n       <?php echo $form->errorSummary($model); ?>\n       <div class=\"row\">\n    <?php echo $form->labelEx($model,'content'); ?>\n    <?php echo $form->textArea($model,'content',array('rows'=>6, 'cols'=>50)); ?>\n    <?php echo $form->error($model,'content'); ?>\n  </div>\n\n  <div class=\"row buttons\">\n    <?php echo CHtml::submitButton($model->isNewRecord ? 'Create' : 'Save'); ?>\n  </div>\n\n<?php $this->endWidget(); ?>\n\n</div>\n```", "```php\nclass Comment extends TrackStarActiveRecord\n{\n  ...\n  public function scopes()\n  {\n    return array(\n      'recent'=>array(\n        'order'=>'create_time DESC',\n        'limit'=>5,\n      ),\n    );\n  }\n...\n}\n```", "```php\n$comments=Comment::model()->recent()->findAll();\n```", "```php\n$comments=Comment::model()->recent()->approved()->findAll();\n```", "```php\npublic function recent($limit=5)\n{\n  $this->getDbCriteria()->mergeWith(\n    array(         \n    'order'=>'t.create_time DESC',         \n      'limit'=>$limit,     \n    )\n  );     \n  return $this;\n}\n```", "```php\n$comments = Comment::model()->with(array('issue'=>array('condition'=>'project_id=1')))->recent(10)->findAll();\n```", "```php\n// First retrieve the project whose ID is 1\n$project=Project::model()->findByPk(1);\n\n// Then retrieve the project's issues (a relational query is actually being performed behind the scenes here)\n$issues=$project->issues;\n```", "```php\n//retrieve all project AR instances along with their associated issue AR instances\n$projects = Project::model()->with('issues')->findAll();\n```", "```php\n$comments = Comment::model()->with(array('issue'=>array('condition'=>'project_id=1')))->recent(10)->findAll();\n```", "```php\nSELECT tbl_comment.*, tbl_issue.* FROM tbl_comment LEFT OUTER JOIN tbl_issue ON (tbl_comment.issue_id=tbl_issue.id) WHERE (tbl_issue.project_id=1) ORDER BY tbl_comment.create_time DESC LIMIT 10;\n```", "```php\n   public function loadModel($id, $withComments=false)\n  {\n    if($withComments)\n      $model = Issue::model()->with(array('comments'=>array('with'=>'author')))->findByPk($id);\n    else\n      $model=Issue::model()->findByPk($id);\n    if($model===null)\n      throw new CHttpException(404,'The requested page does not exist.');\n    return $model;\n  }\n```", "```php\npublic function actionView($id)\n{\n  $issue=$this->loadModel($id, true);\n....\n}\n```", "```php\n<?php\n/**\n     * RecentCommentsWidget is a Yii widget used to display a list of recent comments \n     */\nclass RecentCommentsWidget extends CWidget\n{\n    private $_comments;  \n    public $displayLimit = 5;\n    public $projectId = null;\n\n    public function init()\n        {\n          if(null !== $this->projectId)\n        $this->_comments = Comment::model()->with(array('issue'=>array('condition'=>'project_id='.$this->projectId)))->recent($this->displayLimit)->findAll();\n      else\n        $this->_comments = Comment::model()->recent($this->displayLimit)->findAll();\n        }  \n\n        public function getData()\n        {\n          return $this->_comments;\n        }\n\n        public function run()\n        {\n            // this method is called by CController::endWidget()    \n            $this->render('recentCommentsWidget');\n        }\n}\n```", "```php\n<ul>\n  <?php foreach($this->getData() as $comment): ?>  \n    <div class=\"author\">\n      <?php echo $comment->author->username; ?> added a comment.\n    </div>\n    <div class=\"issue\">      \n       <?php echo CHtml::link(CHtml::encode($comment->issue->name), array('issue/view', 'id'=>$comment->issue->id)); ?>\n      </div>\n\n  <?php endforeach; ?>\n</ul>\n```", "```php\n<?php $this->widget('RecentCommentsWidget'); ?>  \n```", "```php\n<?php $this->beginWidget('zii.widgets.CPortlet', array(\n  'title'=>'Recent Comments',\n));  \n\n$this->widget('RecentCommentsWidget');\n\n$this->endWidget(); ?>\n```", "```php\n<?php\n  $this->beginWidget('zii.widgets.CPortlet', array(\n    'title'=>'Operations',\n  ));\n  $this->widget('zii.widgets.CMenu', array(\n    'items'=>$this->menu,\n    'htmlOptions'=>array('class'=>'operations'),\n  ));\n  $this->endWidget();\n?>\n```", "```php\n<?php $this->beginWidget('zii.widgets.CPortlet', array(\n  'title'=>'Recent Comments On This Project',\n));  \n\n$this->widget('RecentCommentsWidget', array('projectId'=>$model->id));\n\n$this->endWidget(); ?>\n```"]