# 前言

PHP 8 代表了 PHP 核心开发团队为最大化提高核心语言效率所做的工作的巅峰。只要迁移到 PHP 8，您的应用程序代码将立即看到速度提升，同时内存占用也会更小。此外，在 PHP 8 中，开发人员会注意到大量的工作已经投入到规范语法和语言使用上。简而言之，在 PHP 8 中编程对于那些重视良好编码实践的开发人员来说是一种乐趣。

然而，这不可避免地引出了一个问题：PHP 语言未来的发展方向是什么？PHP 8 也提供了这个问题的答案，即即时编译器和对 fibers 的支持。后者构成了异步编程的基础，并已宣布将在 PHP 8.1 中推出。PHP 8 让您一窥语言的未来，而这个未来看起来非常光明！

综合起来，可以清楚地看出，理解和掌握 PHP 8 中实施的新功能和更严格的编码实践对于那些希望追求 PHP 开发人员职业生涯的人来说是至关重要的。这本书正是您快速上手并运用 PHP 8 所需的工具。我们不仅介绍了新功能，还向您展示了如何避免在 PHP 8 迁移后可能导致代码失败的陷阱。此外，我们通过全面介绍 JIT 编译器和 PHP 异步编程，让您一窥 PHP 的未来。

# 这本书是为谁准备的

这本书适用于所有经验水平的 PHP 开发人员，他们具有 PHP 5 或更高版本的经验。如果您刚开始学习 PHP，您会发现代码示例对于更有效地学习使用该语言非常有用。在一个或多个 PHP 项目上工作了几个月的开发人员将能够将这些技巧和技术应用到手头的代码中，而那些具有多年 PHP 经验的开发人员肯定会欣赏对 PHP 8 新功能的简明介绍。

# 这本书涵盖了什么

[*第一章*]，*介绍新的 PHP 8 面向对象编程特性*，向您介绍了针对面向对象编程（OOP）的新 PHP 8 特性。本章包含大量简短的代码示例，清晰地说明了新特性和概念。这一章对于帮助您快速利用 PHP 8 的强大功能并将代码示例适应到您自己的实践中至关重要。

[*第二章*]，*了解 PHP 8 的功能增强*，涵盖了 PHP 8 在过程级别引入的重要增强和改进。它包括大量的代码示例，展示了新的 PHP 8 特性和技术，以便促进过程式编程。本章教会您如何编写更快、更干净的应用程序代码。

[*第三章*]，*利用错误处理增强功能*，探讨了 PHP 8 中的一个关键改进，即其先进的错误处理能力。在本章中，您将了解哪些通知已升级为警告，以及哪些警告现在已经升级为错误。本章将帮助您更好地了解安全增强的背景和意图，从而更好地控制代码的使用。此外，了解以前只生成警告但现在生成错误的错误条件是至关重要的，这样您就可以采取措施防止在升级到 PHP 8 后应用程序失败。

第四章《进行直接的 C 语言调用》帮助您了解外部函数接口（FFI）的全部内容，它的作用以及如何使用它。本章的信息对于对使用直接 C 语言调用进行快速自定义原型设计感兴趣的开发人员非常重要。本章向您展示如何直接将 C 语言结构和函数合并到您的代码中，打开了一个迄今为止对 PHP 不可用的整个功能世界的大门。

第五章《发现潜在的面向对象编程向后兼容性破坏》向您介绍了针对面向对象编程的新 PHP 8 功能。本章包含大量清晰说明新功能和概念的简短代码示例。本章对于帮助您快速利用 PHP 8 的强大功能，并将代码示例调整到您自己的实践中非常关键。此外，本章还强调了在 PHP 8 迁移后可能导致面向对象代码中断的情况。

第六章《理解 PHP 8 的功能差异》涵盖了在 PHP 8 命令或功能级别可能出现的向后不兼容性破坏。本章提供了重要信息，突出了将现有代码迁移到 PHP 8 时可能出现的潜在陷阱。本章中提供的信息使您能够编写可靠的 PHP 代码。通过学习本章中的概念，您将更有能力编写能够产生精确结果并避免不一致性的代码。

第七章《在使用 PHP 8 扩展时避免陷阱》带您了解了对扩展所做的主要更改以及在将现有应用程序更新到 PHP 8 时如何避免陷阱。一旦您完成了对示例代码和主题的审阅，您将能够为将任何现有的 PHP 代码准备好迁移到 PHP 8。除了学习各种扩展的变化之外，您还将深入了解它们的运作方式。这将使您能够在 PHP 8 中使用扩展时做出明智的决策。

第八章《了解 PHP 8 中已弃用或移除的功能》带您了解了在 PHP 8 中已经弃用或移除的功能。在阅读了本章的材料并跟随示例应用代码之后，您将能够检测和重写已经弃用的代码。您还将学习如何为已经移除的功能开发解决方案，以及如何重构使用已移除功能的涉及扩展的代码。本章中您还将学习如何通过重写依赖于在 PHP 8 中已完全移除的功能的代码来提高应用程序的安全性。

第九章《掌握 PHP 8 最佳实践》介绍了在 PHP 8 中现在强制执行的最佳实践。它涵盖了许多重要的方法签名更改以及它们的新用法如何延续了 PHP 的一般趋势，帮助您编写更好的代码。您还将了解到关于私有方法、接口、特征和匿名类的使用变化，以及现在如何解析命名空间。掌握本章涵盖的最佳实践不仅会使您更接近编写更好的代码，还将帮助您避免可能出现的代码中断，如果您没有掌握这些新实践的话。

*第十章*，*性能改进*，向您介绍了一些对性能有积极影响的新 PHP 8 功能，特别关注新的即时编译器。本章还包括对弱引用的全面介绍，正确使用弱引用可以大大减少应用程序的内存使用。通过仔细审阅本章涵盖的内容并学习代码示例，您将能够编写更快速和更高效的代码。

*第十一章*，*将现有 PHP 应用迁移到 PHP 8*，介绍了一组类，这些类构成了 PHP 8 向后兼容断点扫描器的基础。在整本书中，您将看到可能在 PHP 8 更新后出现的潜在代码断点。此外，您将了解将现有客户 PHP 应用程序迁移到 PHP 8 的推荐流程。本章将使您更好地准备处理 PHP 8 迁移，让您能够更有信心地执行 PHP 8 迁移，并最大程度地减少问题。

*第十二章*，*使用异步编程创建 PHP 8 应用程序*，解释了传统同步和异步编程模型之间的区别。近年来，一种令人兴奋的新技术席卷了 PHP 社区：异步编程，也称为 PHP async。此外，还涵盖了流行的 PHP 异步扩展和框架，包括 Swoole 扩展和 ReactPHP，并提供了大量示例供您开始使用。通过完成本章的学习，您将能够提高应用程序的性能，使其速度提高 5 倍甚至惊人的 40 倍！

# 要充分利用本书

要充分利用本书，您必须对 PHP 语法、变量、控制结构（例如，`if {} else {}`）、循环结构（例如，`for () {}`）、数组和函数有基本了解。您还必须对 PHP 面向对象编程有基本了解：类、继承和命名空间。

如果您没有接受过正式的 PHP 培训，或者不确定自己是否具备必要的知识，请查阅在线 PHP 参考手册的以下两个部分：

+   PHP 语言参考：

[`www.php.net/manual/en/langref.php`](https://www.php.net/manual/en/langref.php)

+   PHP 面向对象编程：

[`www.php.net/manual/en/language.oop5.php`](https://www.php.net/manual/en/language.oop5.php)

以下是本书涵盖的软件摘要：

![](img/B16992_Preface_Table1.jpg)

注意

如果您使用的是本书的数字版本，我们建议您自己输入代码，或者从书的 GitHub 存储库中访问代码（下一节中提供了链接）。这样做将帮助您避免与复制和粘贴代码相关的潜在错误。

# 下载示例代码文件

您可以从 GitHub 上下载本书的示例代码文件：[`github.com/PacktPublishing/PHP-8-Programming-Tips-Tricks-and-Best-Practices`](https://github.com/PacktPublishing/PHP-8-Programming-Tips-Tricks-and-Best-Practices)。如果代码有更新，将在 GitHub 存储库中更新。

我们还有来自丰富图书和视频目录的其他代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)上找到。快去看看吧！

# 下载彩色图像

我们还提供了一个 PDF 文件，其中包含本书中使用的屏幕截图和图表的彩色图像。您可以在这里下载：[`static.packt-cdn.com/downloads/9781801071871_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781801071871_ColorImages.pdf)。

# 使用的约定

本书中使用了许多文本约定。

`文本中的代码`：表示文本中的代码词，数据库表名，文件夹名，文件名，文件扩展名，路径名，虚拟 URL，用户输入和 Twitter 句柄。这是一个例子：“本章还教会了您如何将新的`Attribute`类用作 PHP DocBlocks 的最终替代品。”

代码块设置如下：

```php
// /repo/ch01/php7_prop_reduce.php
declare(strict_types=1);
class Test {
 protected $id = 0;
 protected $token = 0;
 protected $name = '';o
```

当我们希望引起您对代码块的特定部分的注意时，相关的行或项目将以粗体显示：

```php
$result = match(<EXPRESSION>) {
    <ITEM> => <EXPRESSION>,
   [<ITEM> => <EXPRESSION>,]
    default => <DEFAULT EXPRESSION>
};
```

任何命令行输入或输出都将按以下方式编写：

```php
Fatal error: Uncaught TypeError: Cannot assign string to property Test::$token of type int in /repo/ch01/php8_prop_danger.php:12
```

提示或重要说明

显示如此。
