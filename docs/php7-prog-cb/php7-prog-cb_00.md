# 前言

PHP 7 已经席卷了开源社区，打破了速度记录，这在比喻上引起了人们的关注。从最基本的意义上讲，核心工程团队对语言进行了重大改写，但仍然成功地保持了很高程度的向后兼容性。这些内部变化的影响在速度上表现出来，速度几乎增加了 200%，内存使用也有了显著的节省。从开发的角度来看，命令解析方式的改变以及统一的变量语法引入了在早期版本的 PHP 中根本不可能的编写代码的新方法。同样，任何不了解 PHP 7 中命令解释方式的开发人员可能会陷入看不见的陷阱，导致代码出现故障。因此，本书的任务是阐明编写代码的新方法，并指出与以前版本的 PHP 不兼容的任何领域。还需要注意的是，本书涵盖了 PHP 7.0 和 7.1。

# 本书内容包括

第一章，*打下基础*，帮助您开始设置和配置 PHP 7 开发环境。我们还将介绍一些强有力的初始示例，展示 PHP 7 的新功能。

第二章，*使用 PHP 7 高性能功能*，深入探讨了语言的新功能。您将了解抽象语法树和统一变量语法等概念，以及这些如何影响日常编程。接着是利用 PHP 7 性能改进的示例，包括`foreach()`循环处理中的重大新变化。

第三章，*使用 PHP 函数式编程*，强调 PHP 一直具有使用程序员定义的函数库而不是类的能力，PHP 7 也不例外。在本章中，我们将更仔细地研究函数处理的改进，包括提供涉及基本数据类型（如整数、浮点数、布尔值和字符串）的“类型提示”，用于输入和输出。我们还将广泛介绍标准 PHP 库中的迭代器，以及如何利用生成器的改进处理编写自己的迭代器。

第四章，*使用 PHP 面向对象编程*，探讨了 PHP 面向对象编程的基础知识。迅速超越基础知识，您将学习如何使用 PHP 命名空间和特征。还将涵盖架构考虑因素，包括如何最好地使用接口。最后，将讨论一个令人兴奋的新功能 PHP 7，即匿名类，并提供其实际用例。

第五章，*与数据库交互*，探讨了应用程序从数据库中读取和写入数据的能力，这是任何现代网站的关键部分。然而，广泛误解的是正确使用 PHP 数据对象（PDO）扩展。本章将全面介绍 PDO，从而使您的应用程序能够与大多数主要数据库交互，包括 MySQL、Oracle、PostgreSQL、IBM DB2 和 Microsoft SQL Server，而无需学习任何其他一套命令。此外，我们还将涵盖高级技术，如使用领域模型实体、执行嵌入式次要查找以及使用 PHP 7 实现 jQuery DataTable 查找。

第六章，*构建可扩展的网站*，深入探讨了 PHP 开发人员在构建交互式网站时面临的经典问题之一——硬编码 HTML 表单，然后需要进行维护。本章介绍了一种简洁高效的面向对象方法，只需很少的代码，就可以生成整个 HTML 表单，并且可以在初始配置中轻松更改。另一个同样棘手的问题是如何过滤和验证从表单提交的数据。在本章中，您将学习如何开发一个易于配置的过滤和验证工厂，然后可以应用于任何传入的提交数据。

第七章，*访问 Web 服务*，涵盖了对 Web 开发越来越重要的内容——发布或消费 Web 服务的能力。本章涵盖了两种关键方法：SOAP 和 REST。您将学习如何实现 SOAP 和 REST 服务器和客户端。此外，所呈现的示例使用了适配器设计模式，这允许相当大程度的定制，这意味着您不会被锁定在特定的设计范式中。

第八章，*处理日期/时间和国际化方面*，帮助您应对由于万维网（WWW）的增长而导致的激烈竞争，从而导致越来越多的客户希望将业务拓展到国际市场。本章将使您了解国际化的各个方面，包括使用表情符号、复杂字符和翻译。此外，您将学习如何获取和处理区域信息，包括语言设置、数字和货币格式化，以及日期和时间。此外，我们还将介绍如何创建国际化日历的配方，这些日历可以处理重复事件。

第九章，*开发中间件*，涉及了当前开源社区中最热门的话题——中间件。顾名思义，中间件是可以“插入”到现有应用程序中，为该应用程序增加价值而无需修改该应用程序源代码的软件。在本章中，您将看到一系列配方，实现为符合 PSR-7 标准的中间件（有关更多详细信息，请参见附录，*定义 PSR-7 类*），执行身份验证、访问控制、缓存和路由。

第十章，*深入了解高级算法*，帮助您了解作为开发人员，鉴于大量的程序员和公司竞争同一业务，掌握关键的高级算法非常重要。在本章中，您将使用 PHP 7 学习获取器和设置器、链表、冒泡排序、栈和二分查找的理论和应用。此外，本章还探讨了如何使用这些技术来实现搜索引擎，以及如何处理多维数组。

第十一章，*实现软件设计模式*，涉及面向对象编程的一个重要方面，即理解关键的软件设计模式。如果没有这些知识，在申请新职位或吸引新客户时，作为开发人员，您将处于严重劣势。本章涵盖了几个非常重要的模式，包括 Hydration、Strategy、Mapper、Object Relational Mapping 和 Pub/Sub。

第十二章，*提高 Web 安全性*，解决了当今互联网的普遍性带来的问题。我们看到网络攻击的频率越来越高，往往造成严重的财务和个人损失。在本章中，我们将提供实用的实用食谱，如果实施，将大大提高您的网站的安全性。涵盖的主题包括过滤和验证、会话保护、安全表单提交、安全密码生成以及使用 CAPTCHA。此外，还介绍了一种食谱，将向您展示如何在不使用 PHP mcrypt 扩展的情况下加密和解密数据，该扩展在 PHP 7.1 中已被弃用（最终将从语言中删除）。

第十三章，*最佳实践、测试和调试*，涵盖了编写良好的代码以使其正常工作的最佳实践和调试。在本章中，您还将学习如何设置和创建单元测试，处理意外错误和异常以及生成测试数据。介绍了几个新的 PHP 7 功能，包括 PHP 7 如何“抛出”错误。重要的是要注意，*最佳实践*在整本书中都有提到，不仅仅是在本章中！

附录，*定义 PSR-7 类*，介绍了最近接受的 PHP 标准建议 7，该标准定义了与中间件一起使用的接口。在本附录中，您将看到 PSR-7 类的实际实现，其中包括 URI、正文和文件上传等值对象，以及请求和响应对象。

# 本书所需的内容

要成功实施本书中提出的食谱，您需要一台计算机、额外 100MB 的磁盘空间以及一个文本或代码编辑器（而不是文字处理软件！）。第一章将介绍如何设置 PHP 7 开发环境。拥有 Web 服务器是可选的，因为 PHP 7 包含开发 Web 服务器。不需要互联网连接，但可能有用以下载代码（例如 PSR-7 接口集），并查看 PHP 7.x 文档。

# 本书适合谁

本书适用于软件架构师、技术经理、中级到高级开发人员，或者只是好奇的人。您需要对 PHP 编程有基本的了解，特别是面向对象编程。

# 章节

在本书中，您将找到一些经常出现的标题（准备工作、如何做、它是如何工作的、还有更多以及另请参阅）。

为了清晰地说明如何完成食谱，我们使用以下各节：

## 准备工作

本节告诉您可以在食谱中期待什么，并描述了如何设置食谱所需的任何软件或任何初步设置。

## 如何做...

本节包含了遵循食谱所需的步骤。

## 它是如何工作的...

本节通常包括对上一节中发生的事情的详细解释。

## 还有更多...

本节包括有关食谱的其他信息，以使读者更加了解食谱。

## 另请参阅

本节提供了有关该食谱的其他有用信息的链接。

# 约定

在本书中，您将找到一些文本样式，用于区分不同类型的信息。以下是这些样式的一些示例以及它们的含义解释。

文本中的代码词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄显示如下：“最后，取出第三个项目中定义的`LotsProps`类，并将其放入一个单独的文件中，`chap_10_oop_using_getters_and_setters_magic_call.php`。”

代码块设置如下：

```php
protected static function loadFile($file)
{
    if (file_exists($file)) {
        require_once $file;
        return TRUE;
    }
    return FALSE;
}
```

当我们希望引起您对代码块的特定部分的注意时，相关的行或项目会以粗体显示：

```php
$params = [
  'db'   => __DIR__ . '/../data/db/php7cookbook.db.sqlite'
];
$dsn  = sprintf(**'sqlite:' . $params['db']**);
```

任何命令行输入或输出都是这样写的：

```php
**cd /path/to/recipes**
**php -S localhost:8080**

```

**新术语**和**重要单词**以粗体显示。屏幕上看到的单词，例如菜单或对话框中的单词，会在文本中以这种方式出现：“当点击**购买**按钮时，初始购买信息会出现。”

### 注意

警告或重要说明会出现在这样的框中。

### 提示

提示和技巧看起来像这样。
